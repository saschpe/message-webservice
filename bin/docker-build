#!/bin/bash
#
# Script to build message webservice docker image.
# Needs root privileges.
#
# Author: Sascha Peilicke <sascha@peilicke.de>
#

if echo $HOME | grep -v -q "/Users/" ; then
    if [ "$EUID" -ne 0 ] ; then
        echo "Please run as root"
        exit
    fi
    # Ensure we have the latest docker binary available (too old on Ubuntu 14.10)
    if test ! -x /usr/bin/docker || test ! -x /usr/bin/docker || docker --version | grep -q "1.0." ; then
        wget -N https://get.docker.com/ -O - | sh
    fi
else
    # We're on Mac OS X
    if test -x /usr/local/bin/boot2docker ; then
        boot2docker shellinit
    else
        # Seems like we use "Docker Toolbox", not the old boot2docker any more...
        eval "$(docker-machine env default)"
    fi
fi


IMAGE=saschpe/message-webservice
VERSION=0.2

docker build -t ${IMAGE}:${VERSION} .
docker tag -f ${IMAGE}:${VERSION} ${IMAGE}:latest
